generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Course Summary Table - Easy browsing and stats
model Course {
  courseCode        String   @id
  totalPosts        Int      @default(0)
  totalComments     Int      @default(0)
  lastUpdated       DateTime @default(now())
  firstPostDate     DateTime?
  latestPostDate    DateTime?
  
  // Track if course has been explicitly crawled (not just discovered via mentions)
  hasFullCrawl      Boolean  @default(false)
  
  // For future incremental crawling
  lastCrawledAt     DateTime?
}



model Post {
  id            String    @id
  subreddit     String
  title         String
  body          String
  score         Int
  createdUtc    Int
  permalink     String
  
  // Array of ALL courses mentioned in this post
  courseCodes   String[]
  
  comments      Comment[]
  
  // Indexes - GIN index enables fast array searches
  @@index([courseCodes], type: Gin)
  @@index([score])
  @@index([createdUtc])
  @@index([score, createdUtc])
}

model Comment {
  id         String @id
  postId     String
  post       Post   @relation(fields: [postId], references: [id])
  body       String
  score      Int
  author     String?
  permalink  String
  createdUtc Int
  
  @@index([postId])
  @@index([score])
}

model Professor {
  id              String   @id @default(cuid())
  
  // RateMyProfessors ID for direct linking
  rmpId           String?
  
  // Core data
  fullName        String
  avgRating       Float?
  numRatings      Int      @default(0)
  avgDifficulty   Float?
  wouldTakeAgain  Int?
  department      String?
  
  // Search optimization - pre-computed name variations
  searchNames     String[]
  
  // Metadata
  school          String   @default("Carleton University")
  
  // Timestamps
  lastCheckedAt   DateTime @default(now())
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  // Indexes for fast lookups
  @@index([searchNames])
  @@index([lastCheckedAt])
  @@index([rmpId])
}

model CourseCache {
  courseCode    String   @id
  insights      Json     // Full Insights object as JSON
  cachedAt      DateTime @default(now())
  
  @@index([courseCode])
}

model SearchStats {
  courseCode      String   @id
  searchCount     Int      @default(0)
  lastSearched    DateTime @default(now())
  
  @@index([searchCount])
  @@index([lastSearched])
}