generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

// Course Summary Table - Easy browsing and stats
model Course {
  courseCode        String   @id
  totalPosts        Int      @default(0)
  totalComments     Int      @default(0)
  lastUpdated       DateTime @default(now())
  firstPostDate     DateTime?
  latestPostDate    DateTime?
  
  // Relations
  mentions          CourseMention[]
}

// Track which courses have been fully crawled (persistent hashset)
model CrawledCourse {
  courseCode   String   @id
  crawledAt    DateTime @default(now())
  lastUpdated  DateTime @updatedAt
}

model Post {
  id         String    @id
  subreddit  String
  title      String
  body       String
  score      Int
  createdUtc Int
  permalink  String
  courseCode String    // Single primary course this post is about
  comments   Comment[]
  
  // Relations for course mentions
  mentions   CourseMention[]
}

// Junction table for course mentions (handles multiple courses per post)
model CourseMention {
  id           String @id @default(cuid())
  courseCode   String
  postId       String
  mentionType  String // 'primary' or 'secondary'
  
  // Relations
  course       Course @relation(fields: [courseCode], references: [courseCode])
  post         Post   @relation(fields: [postId], references: [id])
  
  @@unique([courseCode, postId])
}

model Comment {
  id         String @id
  postId     String
  post       Post   @relation(fields: [postId], references: [id])
  body       String
  score      Int
  author     String?
  permalink  String
  createdUtc Int
}
